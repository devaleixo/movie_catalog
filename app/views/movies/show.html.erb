<div class="row">
  <div class="col-md-4 col-lg-3 mb-4 d-flex justify-content-center">
    <% if @movie.poster.attached? %>
      <%= image_tag @movie.poster, class: "img-fluid movie-detail-poster" %>
    <% elsif @movie.poster_url.present? %>
      <%= image_tag @movie.poster_url, alt: @movie.title, class: "img-fluid movie-detail-poster" %>
    <% else %>
      <%= image_tag "https://via.placeholder.com/400x600.png?text=No+Poster", class: "img-fluid movie-detail-poster" %>
    <% end %>
  </div>

  <div class="col-md-8 col-lg-9">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
      <div class="flex-grow-1 mb-3 mb-md-0">
        <h1 class="mb-2"><%= @movie.title %></h1>
        <% if @movie.rating && @movie.rating > 0 %>
          <div class="rating-stars mb-3" style="font-size: 1.2rem;">
            <% (1..5).each do |i| %>
              <span class="star <%= i <= @movie.star_rating ? '' : 'empty' %>">‚òÖ</span>
            <% end %>
            <span class="rating-value" style="font-size: 1.1rem;"><%= number_with_precision(@movie.star_rating, precision: 1) %></span>
          </div>
        <% end %>
      </div>
      <% if user_signed_in? && @movie.user == current_user %>
        <div class="d-flex gap-2">
          <%= link_to 'Editar', edit_movie_path(@movie), class: 'btn btn-primary' %>
          <%= button_to 'Excluir', @movie, method: :delete, data: { turbo_confirm: 'Tem certeza?' }, class: 'btn btn-danger' %>
        </div>
      <% end %>
    </div>

    <div class="mb-4" style="border-left: 4px solid var(--color-gold); padding-left: 1rem;">
      <p class="lead" style="color: var(--color-off-white); line-height: 1.8;"><%= @movie.synopsis %></p>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <p><strong style="color: var(--color-gold);">üìÖ Ano:</strong> <%= @movie.release_year %></p>
      </div>
      <div class="col-md-4">
        <p><strong style="color: var(--color-gold);">‚è±Ô∏è Dura√ß√£o:</strong> <%= @movie.duration %> min</p>
      </div>
      <div class="col-md-4">
        <p><strong style="color: var(--color-gold);">üé¨ Diretor:</strong> <%= @movie.director %></p>
      </div>
    </div>

    <div class="mb-4">
      <p class="mb-2"><strong style="color: var(--color-gold);">üè∑Ô∏è G√™neros:</strong></p>
      <% if @movie.categories.any? %>
        <div class="d-flex flex-wrap gap-2">
          <% @movie.categories.each do |category| %>
            <span class="badge bg-primary"><%= category.name %></span>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted">Nenhuma categoria atribu√≠da.</p>
      <% end %>
    </div>

    <hr style="border-color: var(--color-medium-gray);">

    <h2 style="color: var(--color-gold); font-size: 1.8rem; margin-bottom: 1.5rem;">üí¨ Coment√°rios</h2>

    <div id="comments">
      <%= render @movie.comments.order(created_at: :desc) %>
    </div>

    <hr style="border-color: var(--color-medium-gray);">

    <h4 style="color: var(--color-gold); margin-bottom: 1rem;">‚úçÔ∏è Adicionar Coment√°rio</h4>
    <%= form_with(model: [@movie, @movie.comments.build]) do |form| %>
      <% if !user_signed_in? %>
        <div class="mb-3">
          <%= form.label :author_name, class: 'form-label' %><br>
          <%= form.text_field :author_name, class: 'form-control' %>
        </div>
      <% end %>
      <div class="mb-3">
        <%= form.label :content, class: 'form-label' %><br>
        <%= form.text_area :content, rows: 3, class: 'form-control' %>
      </div>
      <div class="mb-3">
        <%= form.submit 'Enviar', class: 'btn btn-primary' %>
      </div>
    <% end %>

  </div>
</div>

<div class="mt-4">
  <%= link_to '‚¨Ö Voltar aos Filmes', movies_path, class: 'btn btn-secondary' %>
</div>